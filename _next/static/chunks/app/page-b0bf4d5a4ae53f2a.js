(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6681:function(e,s,t){Promise.resolve().then(t.bind(t,6591))},6591:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return W}});var a=t(3827),n=t(4090),l=t(1639),r=t(3167),i=t(1367);function c(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.m6)((0,r.W)(s))}let d=l.fC,o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.aV,{ref:s,className:c("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...n})});o.displayName=l.aV.displayName;let x=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.xz,{ref:s,className:c("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...n})});x.displayName=l.xz.displayName;let m=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.VY,{ref:s,className:c("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});m.displayName=l.VY.displayName;let h=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});h.displayName="Card";let p=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("flex flex-col space-y-1.5 p-6",t),...n})});p.displayName="CardHeader";let u=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:s,className:c("text-lg font-semibold leading-none tracking-tight",t),...n})});u.displayName="CardTitle",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:s,className:c("text-sm text-muted-foreground",t),...n})}).displayName="CardDescription";let j=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("p-6 pt-0",t),...n})});j.displayName="CardContent",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:c("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter";var f=()=>{let[e,s]=(0,n.useState)({date:new Date().toISOString().split("T")[0],salesPerson:"",approaches:0,appointments:0,meetings:0,trials:0,contracts:0}),t=t=>{let{name:a,value:n}=t.target;s({...e,[a]:"date"===a?n:parseInt(n)||0})};return(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-100",children:(0,a.jsxs)(h,{className:"w-full max-w-md",children:[(0,a.jsx)(p,{className:"bg-blue-600 text-white",children:(0,a.jsx)(u,{className:"text-xl font-bold text-center",children:"日次営業活動入力"})}),(0,a.jsx)(j,{className:"pt-6",children:(0,a.jsx)("form",{onSubmit:t=>{t.preventDefault(),console.log("送信データ:",e),alert("活動データを保存しました！"),s({...e,approaches:0,appointments:0,meetings:0,trials:0,contracts:0})},children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"日付"}),(0,a.jsx)("input",{type:"date",name:"date",value:e.date,onChange:t,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"営業担当者"}),(0,a.jsxs)("select",{name:"salesPerson",value:e.salesPerson,onChange:t,className:"w-full p-2 border rounded",required:!0,children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),(0,a.jsx)("option",{value:"1",children:"鈴木"}),(0,a.jsx)("option",{value:"2",children:"田中"}),(0,a.jsx)("option",{value:"3",children:"佐藤"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"アプローチ数"}),(0,a.jsx)("input",{type:"number",name:"approaches",min:"0",value:e.approaches,onChange:t,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"アポイントメント数"}),(0,a.jsx)("input",{type:"number",name:"appointments",min:"0",value:e.appointments,onChange:t,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"商談数"}),(0,a.jsx)("input",{type:"number",name:"meetings",min:"0",value:e.meetings,onChange:t,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"トライアル成約数"}),(0,a.jsx)("input",{type:"number",name:"trials",min:"0",value:e.trials,onChange:t,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"契約数"}),(0,a.jsx)("input",{type:"number",name:"contracts",min:"0",value:e.contracts,onChange:t,className:"w-full p-2 border rounded"})]})]}),(0,a.jsx)("button",{type:"submit",className:"w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"保存する"})]})})})]})})},g=t(9143);let y=(0,t(9769).j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),N=n.forwardRef((e,s)=>{let{className:t,variant:n,size:l,asChild:r=!1,...i}=e,d=r?g.g7:"button";return(0,a.jsx)(d,{className:c(y({variant:n,size:l,className:t})),ref:s,...i})});N.displayName="Button";let v=n.forwardRef((e,s)=>{let{className:t,type:n,...l}=e;return(0,a.jsx)("input",{type:n,className:c("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});v.displayName="Input";var b=t(9580),w=t(9259),k=t(2235),C=t(7731),S=t(489),E=t(4467),D=t(2848),I=t(4161),A=t(4316);function R(){let[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!0),[r,i]=(0,n.useState)(null),[c,d]=(0,n.useState)((0,E.WU)(new Date,"yyyy-MM")),[o,x]=(0,n.useState)(null),m=async()=>{try{let e=(0,E.WU)((0,D.N)(new Date(c)),"yyyy-MM-dd"),t=(0,E.WU)((0,I.V)(new Date(c)),"yyyy-MM-dd"),a=await fetch("/api/activities?startDate=".concat(e,"&endDate=").concat(t));if(!a.ok)throw Error("データの取得に失敗しました");let n=await a.json();s(n)}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{l(!1)}};(0,n.useEffect)(()=>{m()},[c]);let f=e=>{x({id:e.id,approaches:e.approaches,prospects:e.prospects,meetings:e.meetings,contracts:e.contracts})},g=()=>{x(null)},y=async()=>{if(o)try{if(!(await fetch("/api/activities/".concat(o.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw Error("活動データの更新に失敗しました");m(),x(null)}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},R=async e=>{if(confirm("この活動データを削除してもよろしいですか？"))try{if(!(await fetch("/api/activities/".concat(e),{method:"DELETE"})).ok)throw Error("活動データの削除に失敗しました");m()}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},K=(e,s)=>{o&&x({...o,[e]:parseInt(s)||0})},M=(()=>{let s=e.reduce((e,s)=>e+s.approaches,0),t=e.reduce((e,s)=>e+s.prospects,0),a=e.reduce((e,s)=>e+s.meetings,0),n=e.reduce((e,s)=>e+s.contracts,0);return{totalApproaches:s,totalProspects:t,totalMeetings:a,totalContracts:n,prospectRate:s?t/s*100:0,meetingRate:t?a/t*100:0,contractRate:a?n/a*100:0}})();return t?(0,a.jsx)(h,{children:(0,a.jsx)(j,{className:"flex items-center justify-center p-6",children:(0,a.jsx)(b.Z,{className:"h-6 w-6 animate-spin"})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"営業活動ダッシュボード"}),(0,a.jsx)("input",{type:"month",value:c,onChange:e=>d(e.target.value),className:"px-3 py-2 border rounded-md"})]}),r&&(0,a.jsx)("div",{className:"bg-red-50 text-red-700 p-4 rounded-md",children:r}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月のアプローチ数"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"text-3xl font-bold",children:M.totalApproaches})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月のアポ数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:M.totalProspects}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["取得率: ",M.prospectRate.toFixed(1),"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月の商談数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:M.totalMeetings}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["商談化率: ",M.meetingRate.toFixed(1),"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月の契約数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:M.totalContracts}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["成約率: ",M.contractRate.toFixed(1),"%"]})]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"活動データ一覧"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"日付"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"担当者"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"アプローチ"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"アポ"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"商談"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"契約"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center",children:"操作"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,E.WU)(new Date(e.date),"M/d (E)",{locale:A.ja})}),(0,a.jsx)("td",{className:"px-4 py-2",children:e.salesperson.name}),(null==o?void 0:o.id)===e.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(v,{type:"number",min:"0",value:o.approaches,onChange:e=>K("approaches",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(v,{type:"number",min:"0",value:o.prospects,onChange:e=>K("prospects",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(v,{type:"number",min:"0",value:o.meetings,onChange:e=>K("meetings",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(v,{type:"number",min:"0",value:o.contracts,onChange:e=>K("contracts",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2 text-center",children:(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,a.jsx)(N,{variant:"ghost",size:"sm",onClick:y,children:(0,a.jsx)(w.Z,{className:"h-4 w-4"})}),(0,a.jsx)(N,{variant:"ghost",size:"sm",onClick:g,children:(0,a.jsx)(k.Z,{className:"h-4 w-4"})})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.approaches}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.prospects}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.meetings}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.contracts}),(0,a.jsx)("td",{className:"px-4 py-2 text-center",children:(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,a.jsx)(N,{variant:"ghost",size:"sm",onClick:()=>f(e),children:(0,a.jsx)(C.Z,{className:"h-4 w-4"})}),(0,a.jsx)(N,{variant:"ghost",size:"sm",onClick:()=>R(e.id),children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})})]})})]})]},e.id))})]})})})]})]})}let K=e=>{let{prospects:s,statuses:t,onEdit:n,onStatusChange:l}=e,r=e=>{let s=t.find(s=>s.id===e);return s?s.name:"不明"},i=e=>{switch(e){case 1:default:return"bg-gray-100";case 2:return"bg-blue-100";case 3:return"bg-yellow-100";case 4:return"bg-green-100";case 5:return"bg-purple-100"}};return(0,a.jsx)("div",{className:"overflow-x-auto",children:0===s.length?(0,a.jsx)("p",{className:"text-center py-4",children:"案件がありません"}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"企業名"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"担当者"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"次回アクション"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.companyName})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{children:e.contactName}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.contactInfo})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(i(e.status)),children:r(e.status)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.nextAction}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>n(e),className:"text-indigo-600 hover:text-indigo-900 mr-2",children:"編集"}),(0,a.jsx)("select",{value:e.status,onChange:s=>l(e.id,parseInt(s.target.value)),className:"text-sm border rounded p-1",children:t.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name,"に変更"]},e.id))})]})]},e.id))})]})})};var M=()=>{let e=[{id:1,name:"アプローチ済"},{id:2,name:"アポ予定"},{id:3,name:"商談実施"},{id:4,name:"トライアル中"},{id:5,name:"契約済"}],[s,t]=(0,n.useState)([{id:1,companyName:"株式会社ABC",contactName:"山田太郎",contactInfo:"yamada@abc.co.jp",status:2,nextAction:"2025-04-01",notes:"初回アポ設定済み"},{id:2,companyName:"株式会社DEF",contactName:"佐藤次郎",contactInfo:"sato@def.co.jp",status:3,nextAction:"2025-04-03",notes:"商談でニーズヒアリング完了"},{id:3,companyName:"株式会社GHI",contactName:"鈴木三郎",contactInfo:"suzuki@ghi.co.jp",status:4,nextAction:"2025-04-15",notes:"トライアル中、使用感フィードバック待ち"},{id:4,companyName:"株式会社JKL",contactName:"高橋四郎",contactInfo:"takahashi@jkl.co.jp",status:1,nextAction:"2025-03-28",notes:"アプローチメール送信済み"},{id:5,companyName:"株式会社MNO",contactName:"田中五郎",contactInfo:"tanaka@mno.co.jp",status:5,nextAction:"2025-05-01",notes:"契約済み、導入サポート予定"}]),[l,r]=(0,n.useState)({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",notes:""}),[i,c]=(0,n.useState)(null),f=e=>{let{name:s,value:t}=e.target;r({...l,[s]:"status"===s?parseInt(t):t})},g=e=>{r({companyName:e.companyName,contactName:e.contactName,contactInfo:e.contactInfo,status:e.status,nextAction:e.nextAction,notes:e.notes}),c(e.id)},y=(e,s)=>"all"===s?e:e.filter(e=>e.status===parseInt(s)),N=(e,a)=>{t(s.map(s=>s.id===e?{...s,status:a}:s))};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)(d,{defaultValue:"all",className:"w-full",children:[(0,a.jsxs)(o,{className:"mb-4",children:[(0,a.jsx)(x,{value:"all",children:"全ての案件"}),e.map(e=>(0,a.jsx)(x,{value:e.id.toString(),children:e.name},e.id))]}),(0,a.jsx)(m,{value:"all",children:(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"全ての案件"})}),(0,a.jsx)(j,{children:(0,a.jsx)(K,{prospects:s,statuses:e,onEdit:g,onStatusChange:N})})]})}),e.map(t=>(0,a.jsx)(m,{value:t.id.toString(),children:(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsxs)(u,{children:[t.name,"の案件"]})}),(0,a.jsx)(j,{children:(0,a.jsx)(K,{prospects:y(s,t.id.toString()),statuses:e,onEdit:g,onStatusChange:N})})]})},t.id))]}),(0,a.jsxs)(h,{className:"mt-8",children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:i?"案件を編集":"新規案件を追加"})}),(0,a.jsx)(j,{children:(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),i)t(s.map(e=>e.id===i?{...l,id:i}:e)),c(null);else{let e=Math.max(...s.map(e=>e.id),0)+1;t([...s,{...l,id:e}])}r({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",notes:""})},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"会社名"}),(0,a.jsx)("input",{type:"text",name:"companyName",value:l.companyName,onChange:f,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"担当者名"}),(0,a.jsx)("input",{type:"text",name:"contactName",value:l.contactName,onChange:f,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"連絡先"}),(0,a.jsx)("input",{type:"text",name:"contactInfo",value:l.contactInfo,onChange:f,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"ステータス"}),(0,a.jsx)("select",{name:"status",value:l.status,onChange:f,className:"mt-1 block w-full border rounded-md shadow-sm p-2",children:e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"次のアクション"}),(0,a.jsx)("input",{type:"date",name:"nextAction",value:l.nextAction,onChange:f,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"備考"}),(0,a.jsx)("textarea",{name:"notes",value:l.notes,onChange:f,className:"mt-1 block w-full border rounded-md shadow-sm p-2",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:i?"更新":"追加"}),i&&(0,a.jsx)("button",{type:"button",onClick:()=>{c(null),r({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",notes:""})},className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"キャンセル"})]})]})})]})]})},P=t(6587),T=t(6363),q=t(8333),z=t(3356),F=t(2983),O=t(166),V=t(4866),Z=t(8061),_=t(1433),B=t(8485),L=()=>{let[e,s]=(0,n.useState)("1"),[t,l]=(0,n.useState)(null),[r,i]=(0,n.useState)([]),[c,f]=(0,n.useState)([]),[g,y]=(0,n.useState)([]),[N,v]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{try{let[s,t]=await Promise.all([fetch("/api/sales"),fetch("/api/prospects")]);if(!s.ok||!t.ok)throw Error("Failed to fetch data");let[a,n]=await Promise.all([s.json(),t.json()]),r=new Date().getMonth()+1,c=new Date().getFullYear(),d=a.filter(e=>{let[s,t]=e.date.split("-").map(Number);return s===c&&t===r}).reduce((e,s)=>({アプローチ数:e.アプローチ数+s.approaches,アポ数:e.アポ数+s.appointments,商談数:e.商談数+s.meetings,契約数:e.契約数+s.contracts}),{アプローチ数:0,アポ数:0,商談数:0,契約数:0}),o={salesPerson:e,期間:"".concat(c,"年").concat(r,"月"),...d,アポ取得率:d.アポ数/d.アプローチ数*100,商談化率:d.商談数/d.アポ数*100,成約率:d.契約数/d.商談数*100,目標達成率:0};l(o);let x=a.map(e=>({date:e.date,アプローチ数:e.approaches,アポ数:e.appointments,商談数:e.meetings,契約数:e.contracts,アポ取得率:e.appointments/e.approaches*100,商談化率:e.meetings/e.appointments*100,成約率:e.contracts/e.meetings*100}));i(x);let m=n.reduce((e,s)=>{let t=s.status,a=e.find(e=>e.ステージ===t);return a?(a.件数++,a.案件リスト.push({会社名:s.companyName,担当者名:s.contactPerson,次回アクション:s.nextAction,次回アクション日:s.nextActionDate,商談金額:s.amount})):e.push({ステージ:t,件数:1,案件リスト:[{会社名:s.companyName,担当者名:s.contactPerson,次回アクション:s.nextAction,次回アクション日:s.nextActionDate,商談金額:s.amount}]}),e},[]);f(m),y([{時間帯:"9-11時",アプローチ成功率:35,アポ取得率:25,商談件数:2},{時間帯:"11-13時",アプローチ成功率:28,アポ取得率:20,商談件数:1},{時間帯:"13-15時",アプローチ成功率:42,アポ取得率:32,商談件数:3},{時間帯:"15-17時",アプローチ成功率:38,アポ取得率:28,商談件数:2},{時間帯:"17-19時",アプローチ成功率:30,アポ取得率:22,商談件数:1}])}catch(e){console.error("Error fetching data:",e)}finally{v(!1)}})()},[e]),N)?(0,a.jsx)("div",{children:"データを読み込み中..."}):t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("select",{value:e,onChange:e=>s(e.target.value),className:"w-full max-w-xs p-2 border rounded-md",children:[(0,a.jsx)("option",{value:"1",children:"鈴木"}),(0,a.jsx)("option",{value:"2",children:"田中"}),(0,a.jsx)("option",{value:"3",children:"佐藤"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"アプローチ数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.アプローチ数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["目標達成率: ",t.目標達成率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"アポイント数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.アポ数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["取得率: ",t.アポ取得率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"商談数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.商談数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["商談化率: ",t.商談化率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"契約数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.契約数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["成約率: ",t.成約率,"%"]})]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"活動推移"})}),(0,a.jsx)(j,{children:(0,a.jsxs)(d,{defaultValue:"daily",className:"w-full",children:[(0,a.jsxs)(o,{children:[(0,a.jsx)(x,{value:"daily",children:"日次"}),(0,a.jsx)(x,{value:"weekly",children:"週次"}),(0,a.jsx)(x,{value:"monthly",children:"月次"})]}),(0,a.jsx)(m,{value:"daily",children:(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(P.h,{width:"100%",height:"100%",children:(0,a.jsxs)(T.w,{data:r,children:[(0,a.jsx)(q.q,{strokeDasharray:"3 3"}),(0,a.jsx)(z.K,{dataKey:"date"}),(0,a.jsx)(F.B,{}),(0,a.jsx)(O.u,{}),(0,a.jsx)(V.D,{}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"アプローチ数",stroke:"#8884d8"}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"アポ数",stroke:"#82ca9d"}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"商談数",stroke:"#ffc658"}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"契約数",stroke:"#ff7300"})]})})})})]})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"転換率推移"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(P.h,{width:"100%",height:"100%",children:(0,a.jsxs)(T.w,{data:r,children:[(0,a.jsx)(q.q,{strokeDasharray:"3 3"}),(0,a.jsx)(z.K,{dataKey:"date"}),(0,a.jsx)(F.B,{}),(0,a.jsx)(O.u,{}),(0,a.jsx)(V.D,{}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"アポ取得率",stroke:"#8884d8"}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"商談化率",stroke:"#82ca9d"}),(0,a.jsx)(Z.x,{type:"monotone",dataKey:"成約率",stroke:"#ffc658"})]})})})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"案件パイプライン"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:c.map((e,s)=>(0,a.jsxs)(h,{className:"bg-gray-50",children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsxs)(u,{className:"text-sm font-medium",children:[e.ステージ,(0,a.jsxs)("span",{className:"ml-2 text-blue-600",children:[e.件数,"件"]})]})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"space-y-2",children:e.案件リスト.map((e,s)=>(0,a.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"font-medium",children:e.会社名}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.担当者名}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["次回: ",e.次回アクション,"（",e.次回アクション日,"）"]}),(0,a.jsxs)("div",{className:"text-sm font-medium text-blue-600",children:["\xa5",e.商談金額.toLocaleString()]})]},s))})})]},s))})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"時間帯別活動効率"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(P.h,{width:"100%",height:"100%",children:(0,a.jsxs)(_.v,{data:g,children:[(0,a.jsx)(q.q,{strokeDasharray:"3 3"}),(0,a.jsx)(z.K,{dataKey:"時間帯"}),(0,a.jsx)(F.B,{}),(0,a.jsx)(O.u,{}),(0,a.jsx)(V.D,{}),(0,a.jsx)(B.$,{dataKey:"アプローチ成功率",fill:"#8884d8"}),(0,a.jsx)(B.$,{dataKey:"アポ取得率",fill:"#82ca9d"})]})})})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"本日のアクション"})}),(0,a.jsx)(j,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[c.flatMap(e=>e.案件リスト.filter(e=>e.次回アクション日===new Date().toISOString().split("T")[0]).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.会社名}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.次回アクション})]}),(0,a.jsx)("div",{className:"text-sm text-blue-600",children:e.次回アクション日})]},s))),c.every(e=>e.案件リスト.every(e=>e.次回アクション日!==new Date().toISOString().split("T")[0]))&&(0,a.jsx)("div",{className:"text-gray-500 text-center py-4",children:"本日のアクション予定はありません"})]})})]})]})]}):(0,a.jsx)("div",{children:"データが見つかりません"})};function U(){let[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(""),[r,i]=(0,n.useState)(!0),[c,d]=(0,n.useState)(null),[o,x]=(0,n.useState)(!1),m=async()=>{try{let e=await fetch("/api/salespersons");if(!e.ok)throw Error("担当者データの取得に失敗しました");let t=await e.json();s(t)}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{i(!1)}};(0,n.useEffect)(()=>{m()},[]);let f=async e=>{if(e.preventDefault(),t.trim()){x(!0);try{if(!(await fetch("/api/salespersons",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.trim()})})).ok)throw Error("担当者の追加に失敗しました");l(""),m()}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{x(!1)}}},g=async e=>{if(confirm("この担当者を削除してもよろしいですか？")){x(!0);try{if(!(await fetch("/api/salespersons",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok)throw Error("担当者の削除に失敗しました");m()}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{x(!1)}}};return r?(0,a.jsx)(h,{children:(0,a.jsx)(j,{className:"flex items-center justify-center p-6",children:(0,a.jsx)(b.Z,{className:"h-6 w-6 animate-spin"})})}):(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"担当者管理"})}),(0,a.jsxs)(j,{children:[c&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-md",children:c}),(0,a.jsx)("form",{onSubmit:f,className:"mb-6",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(v,{type:"text",value:t,onChange:e=>l(e.target.value),placeholder:"担当者名",required:!0}),(0,a.jsx)(N,{type:"submit",disabled:o,children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"追加中..."]}):"追加"})]})}),(0,a.jsx)("div",{className:"space-y-2",children:0===e.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"担当者が登録されていません"}):e.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)(N,{variant:"ghost",size:"sm",onClick:()=>g(e.id),disabled:o,className:"text-red-600 hover:text-red-800",children:"削除"})]},e.id))})]})]})}function W(){return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"営業管理システム"}),(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsxs)(d,{defaultValue:"dashboard",className:"w-full",children:[(0,a.jsxs)(o,{className:"mb-8",children:[(0,a.jsx)(x,{value:"dashboard",children:"全体ダッシュボード"}),(0,a.jsx)(x,{value:"personal",children:"担当者別"}),(0,a.jsx)(x,{value:"daily-input",children:"日次入力"}),(0,a.jsx)(x,{value:"prospects",children:"案件管理"}),(0,a.jsx)(x,{value:"salespersons",children:"担当者管理"})]}),(0,a.jsx)(m,{value:"dashboard",children:(0,a.jsx)(R,{})}),(0,a.jsx)(m,{value:"personal",children:(0,a.jsx)(L,{})}),(0,a.jsx)(m,{value:"daily-input",children:(0,a.jsx)(f,{})}),(0,a.jsx)(m,{value:"prospects",children:(0,a.jsx)(M,{})}),(0,a.jsx)(m,{value:"salespersons",children:(0,a.jsx)(U,{})})]})})]})})}}},function(e){e.O(0,[638,971,69,744],function(){return e(e.s=6681)}),_N_E=e.O()}]);