(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6681:function(e,s,t){Promise.resolve().then(t.bind(t,8496))},8496:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return G}});var a=t(3827),r=t(4090),n=t(1639),l=t(3167),i=t(1367);function c(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.m6)((0,l.W)(s))}let d=n.fC,o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.aV,{ref:s,className:c("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...r})});o.displayName=n.aV.displayName;let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.xz,{ref:s,className:c("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...r})});x.displayName=n.xz.displayName;let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n.VY,{ref:s,className:c("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r})});m.displayName=n.VY.displayName;let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});h.displayName="Card";let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("flex flex-col space-y-1.5 p-6",t),...r})});p.displayName="CardHeader";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:c("text-lg font-semibold leading-none tracking-tight",t),...r})});u.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:c("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("p-6 pt-0",t),...r})});j.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var f=t(9769);let g=(0,f.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=r.forwardRef((e,s)=>{let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:c(g({variant:r}),t),...n})});y.displayName="Alert",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:c("mb-1 font-medium leading-none tracking-tight",t),...r})}).displayName="AlertTitle";let N=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("text-sm [&_p]:leading-relaxed",t),...r})});N.displayName="AlertDescription";var v=t(9580),b=()=>{let[e,s]=(0,r.useState)({date:new Date().toISOString().split("T")[0],salesPerson:"",approaches:0,appointments:0,meetings:0,trials:0,contracts:0}),[t,n]=(0,r.useState)(!1),[l,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),o=t=>{let{name:a,value:r}=t.target;s({...e,[a]:"date"===a?r:parseInt(r)||0})},x=async t=>{t.preventDefault(),n(!0),i(null),d(!1);try{if(!(await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("データの送信に失敗しました");d(!0),s({...e,approaches:0,appointments:0,meetings:0,trials:0,contracts:0})}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{n(!1)}};return(0,a.jsxs)(h,{className:"w-full max-w-md mx-auto",children:[(0,a.jsx)(p,{className:"bg-blue-600 text-white",children:(0,a.jsx)(u,{className:"text-xl font-bold text-center",children:"日次営業活動入力"})}),(0,a.jsxs)(j,{className:"pt-6",children:[l&&(0,a.jsx)(y,{variant:"destructive",className:"mb-4",children:(0,a.jsx)(N,{children:l})}),c&&(0,a.jsx)(y,{className:"mb-4",children:(0,a.jsx)(N,{children:"データを保存しました！"})}),(0,a.jsx)("form",{onSubmit:x,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"日付"}),(0,a.jsx)("input",{type:"date",name:"date",value:e.date,onChange:o,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"営業担当者"}),(0,a.jsxs)("select",{name:"salesPerson",value:e.salesPerson,onChange:o,className:"w-full p-2 border rounded",required:!0,children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),(0,a.jsx)("option",{value:"鈴木",children:"鈴木"}),(0,a.jsx)("option",{value:"田中",children:"田中"}),(0,a.jsx)("option",{value:"佐藤",children:"佐藤"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"アプローチ数"}),(0,a.jsx)("input",{type:"number",name:"approaches",min:"0",value:e.approaches,onChange:o,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"アポイントメント数"}),(0,a.jsx)("input",{type:"number",name:"appointments",min:"0",value:e.appointments,onChange:o,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"商談数"}),(0,a.jsx)("input",{type:"number",name:"meetings",min:"0",value:e.meetings,onChange:o,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"トライアル成約数"}),(0,a.jsx)("input",{type:"number",name:"trials",min:"0",value:e.trials,onChange:o,className:"w-full p-2 border rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"契約数"}),(0,a.jsx)("input",{type:"number",name:"contracts",min:"0",value:e.contracts,onChange:o,className:"w-full p-2 border rounded"})]})]}),(0,a.jsx)("button",{type:"submit",disabled:t,className:"w-full p-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"保存中..."]}):"保存する"})]})})]})]})},w=t(9143);let k=(0,f.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),S=r.forwardRef((e,s)=>{let{className:t,variant:r,size:n,asChild:l=!1,...i}=e,d=l?w.g7:"button";return(0,a.jsx)(d,{className:c(k({variant:r,size:n,className:t})),ref:s,...i})});S.displayName="Button";let C=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:c("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});C.displayName="Input";var E=t(9259),D=t(2235),A=t(7731),R=t(489),T=t(4467),I=t(2848),P=t(4161),K=t(4316);function O(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),[l,i]=(0,r.useState)(null),[c,d]=(0,r.useState)((0,T.WU)(new Date,"yyyy-MM")),[o,x]=(0,r.useState)(null),m=async()=>{try{let e=(0,T.WU)((0,I.N)(new Date(c)),"yyyy-MM-dd"),t=(0,T.WU)((0,P.V)(new Date(c)),"yyyy-MM-dd"),a=await fetch("/api/activities?startDate=".concat(e,"&endDate=").concat(t));if(!a.ok)throw Error("データの取得に失敗しました");let r=await a.json();s(r)}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{n(!1)}};(0,r.useEffect)(()=>{m()},[c]);let f=e=>{x({id:e.id,approaches:e.approaches,prospects:e.prospects,meetings:e.meetings,contracts:e.contracts})},g=()=>{x(null)},y=async()=>{if(o)try{if(!(await fetch("/api/activities/".concat(o.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw Error("活動データの更新に失敗しました");m(),x(null)}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},N=async e=>{if(confirm("この活動データを削除してもよろしいですか？"))try{if(!(await fetch("/api/activities/".concat(e),{method:"DELETE"})).ok)throw Error("活動データの削除に失敗しました");m()}catch(e){i(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},b=(e,s)=>{o&&x({...o,[e]:parseInt(s)||0})},w=(()=>{let s=e.reduce((e,s)=>e+s.approaches,0),t=e.reduce((e,s)=>e+s.prospects,0),a=e.reduce((e,s)=>e+s.meetings,0),r=e.reduce((e,s)=>e+s.contracts,0);return{totalApproaches:s,totalProspects:t,totalMeetings:a,totalContracts:r,prospectRate:s?t/s*100:0,meetingRate:t?a/t*100:0,contractRate:a?r/a*100:0}})();return t?(0,a.jsx)(h,{children:(0,a.jsx)(j,{className:"flex items-center justify-center p-6",children:(0,a.jsx)(v.Z,{className:"h-6 w-6 animate-spin"})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"営業活動ダッシュボード"}),(0,a.jsx)("input",{type:"month",value:c,onChange:e=>d(e.target.value),className:"px-3 py-2 border rounded-md"})]}),l&&(0,a.jsx)("div",{className:"bg-red-50 text-red-700 p-4 rounded-md",children:l}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月のアプローチ数"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"text-3xl font-bold",children:w.totalApproaches})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月のアポ数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:w.totalProspects}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["取得率: ",w.prospectRate.toFixed(1),"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月の商談数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:w.totalMeetings}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["商談化率: ",w.meetingRate.toFixed(1),"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"今月の契約数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:w.totalContracts}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["成約率: ",w.contractRate.toFixed(1),"%"]})]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"活動データ一覧"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"日付"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"担当者"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"アプローチ"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"アポ"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"商談"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right",children:"契約"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center",children:"操作"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,T.WU)(new Date(e.date),"M/d (E)",{locale:K.ja})}),(0,a.jsx)("td",{className:"px-4 py-2",children:e.salesperson.name}),(null==o?void 0:o.id)===e.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(C,{type:"number",min:"0",value:o.approaches,onChange:e=>b("approaches",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(C,{type:"number",min:"0",value:o.prospects,onChange:e=>b("prospects",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(C,{type:"number",min:"0",value:o.meetings,onChange:e=>b("meetings",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)(C,{type:"number",min:"0",value:o.contracts,onChange:e=>b("contracts",e.target.value),className:"w-20"})}),(0,a.jsx)("td",{className:"px-4 py-2 text-center",children:(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:y,children:(0,a.jsx)(E.Z,{className:"h-4 w-4"})}),(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:g,children:(0,a.jsx)(D.Z,{className:"h-4 w-4"})})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.approaches}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.prospects}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.meetings}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.contracts}),(0,a.jsx)("td",{className:"px-4 py-2 text-center",children:(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:()=>f(e),children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})}),(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:()=>N(e.id),children:(0,a.jsx)(R.Z,{className:"h-4 w-4"})})]})})]})]},e.id))})]})})})]})]})}var q=t(7907);let M=e=>{let{prospects:s,statuses:t,onEdit:r,onDelete:n,onStatusChange:l}=e,i=e=>{let s=t.find(s=>s.id===e);return s?s.name:"不明"},c=e=>{switch(e){case 1:default:return"bg-gray-100";case 2:return"bg-blue-100";case 3:return"bg-yellow-100";case 4:return"bg-green-100";case 5:return"bg-purple-100"}};return(0,a.jsx)("div",{className:"overflow-x-auto",children:0===s.length?(0,a.jsx)("p",{className:"text-center py-4",children:"案件がありません"}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"企業名"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"担当者"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"次回アクション"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.companyName})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{children:e.contactName}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.contactInfo})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(c(e.status)),children:i(e.status)})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,a.jsx)("div",{children:e.nextAction}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.nextActionDate})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)(S,{onClick:()=>r(e),variant:"ghost",className:"mr-2",children:"編集"}),(0,a.jsx)(S,{onClick:()=>n(e.id),variant:"ghost",className:"text-red-600 hover:text-red-900",children:"削除"}),(0,a.jsx)("select",{value:e.status,onChange:s=>l(e.id,parseInt(s.target.value)),className:"ml-2 text-sm border rounded p-1",children:t.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name,"に変更"]},e.id))})]})]},e.id))})]})})};var V=()=>{(0,q.useRouter)();let e=(0,q.useSearchParams)().get("salespersonId"),s=[{id:1,name:"アプローチ済"},{id:2,name:"アポ予定"},{id:3,name:"商談実施"},{id:4,name:"トライアル中"},{id:5,name:"契約済"}],[t,n]=(0,r.useState)([]),[l,i]=(0,r.useState)(!0),[c,f]=(0,r.useState)(null),[g,v]=(0,r.useState)({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",nextActionDate:"",notes:""}),[b,w]=(0,r.useState)(null),k=e=>{let{name:s,value:t}=e.target;v({...g,[s]:"status"===s?parseInt(t):t})},C=async s=>{s.preventDefault();try{let s={...g,salespersonId:e||void 0};if(b){if(!(await fetch("/api/prospects?id=".concat(b),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:b,...s})})).ok)throw Error("案件の更新に失敗しました")}else if(!(await fetch("/api/prospects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("案件の追加に失敗しました");A(),v({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",nextActionDate:"",notes:""}),w(null)}catch(e){f(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},E=e=>{v({companyName:e.companyName,contactName:e.contactName,contactInfo:e.contactInfo,status:e.status,nextAction:e.nextAction,nextActionDate:e.nextActionDate,notes:e.notes}),w(e.id)},D=async e=>{if(confirm("この案件を削除してもよろしいですか？"))try{if(!(await fetch("/api/prospects?id=".concat(e),{method:"DELETE"})).ok)throw Error("案件の削除に失敗しました");A()}catch(e){f(e instanceof Error?e.message:"予期せぬエラーが発生しました")}},A=async()=>{try{let s=e?"/api/prospects?salespersonId=".concat(e):"/api/prospects",t=await fetch(s);if(!t.ok)throw Error("案件データの取得に失敗しました");let a=await t.json();n(a),f(null)}catch(e){f(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{i(!1)}};(0,r.useEffect)(()=>{A()},[e]);let R=(e,s)=>"all"===s?e:e.filter(e=>e.status===parseInt(s)),T=async(e,s)=>{try{let a=t.find(s=>s.id===e);if(!a)return;if(!(await fetch("/api/prospects?id=".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,status:s})})).ok)throw Error("ステータスの更新に失敗しました");A()}catch(e){f(e instanceof Error?e.message:"予期せぬエラーが発生しました")}};return l?(0,a.jsx)("div",{className:"text-center py-4",children:"読み込み中..."}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[c&&(0,a.jsx)(y,{className:"mb-4",children:(0,a.jsx)(N,{children:c})}),(0,a.jsxs)(d,{defaultValue:"all",className:"w-full",children:[(0,a.jsxs)(o,{className:"mb-4",children:[(0,a.jsx)(x,{value:"all",children:"全ての案件"}),s.map(e=>(0,a.jsx)(x,{value:e.id.toString(),children:e.name},e.id))]}),(0,a.jsx)(m,{value:"all",children:(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"全ての案件"})}),(0,a.jsx)(j,{children:(0,a.jsx)(M,{prospects:t,statuses:s,onEdit:E,onDelete:D,onStatusChange:T})})]})}),s.map(e=>(0,a.jsx)(m,{value:e.id.toString(),children:(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsxs)(u,{children:[e.name,"の案件"]})}),(0,a.jsx)(j,{children:(0,a.jsx)(M,{prospects:R(t,e.id.toString()),statuses:s,onEdit:E,onDelete:D,onStatusChange:T})})]})},e.id))]}),(0,a.jsxs)(h,{className:"mt-8",children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:b?"案件を編集":"新規案件を追加"})}),(0,a.jsx)(j,{children:(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"会社名"}),(0,a.jsx)("input",{type:"text",name:"companyName",value:g.companyName,onChange:k,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"担当者名"}),(0,a.jsx)("input",{type:"text",name:"contactName",value:g.contactName,onChange:k,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"連絡先"}),(0,a.jsx)("input",{type:"text",name:"contactInfo",value:g.contactInfo,onChange:k,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"ステータス"}),(0,a.jsx)("select",{name:"status",value:g.status,onChange:k,className:"mt-1 block w-full border rounded-md shadow-sm p-2",children:s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"次のアクション"}),(0,a.jsx)("input",{type:"text",name:"nextAction",value:g.nextAction,onChange:k,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"次回アクション日"}),(0,a.jsx)("input",{type:"date",name:"nextActionDate",value:g.nextActionDate,onChange:k,required:!0,className:"mt-1 block w-full border rounded-md shadow-sm p-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"備考"}),(0,a.jsx)("textarea",{name:"notes",value:g.notes,onChange:k,className:"mt-1 block w-full border rounded-md shadow-sm p-2",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)(S,{type:"submit",variant:"default",children:b?"更新":"追加"}),b&&(0,a.jsx)(S,{type:"button",variant:"outline",onClick:()=>{w(null),v({companyName:"",contactName:"",contactInfo:"",status:1,nextAction:"",nextActionDate:"",notes:""})},children:"キャンセル"})]})]})})]})]})},z=t(6587),F=t(6363),Z=t(8333),J=t(3356),U=t(2983),_=t(166),L=t(4866),W=t(8061),B=t(1433),Y=t(8485),$=()=>{let[e,s]=(0,r.useState)("1"),[t,n]=(0,r.useState)(null),[l,i]=(0,r.useState)([]),[c,f]=(0,r.useState)([]),[g,y]=(0,r.useState)([]),[N,v]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{try{let[s,t]=await Promise.all([fetch("/api/sales"),fetch("/api/prospects")]);if(!s.ok||!t.ok)throw Error("Failed to fetch data");let[a,r]=await Promise.all([s.json(),t.json()]),l=new Date().getMonth()+1,c=new Date().getFullYear(),d=a.filter(e=>{let[s,t]=e.date.split("-").map(Number);return s===c&&t===l}).reduce((e,s)=>({アプローチ数:e.アプローチ数+s.approaches,アポ数:e.アポ数+s.appointments,商談数:e.商談数+s.meetings,契約数:e.契約数+s.contracts}),{アプローチ数:0,アポ数:0,商談数:0,契約数:0}),o={salesPerson:e,期間:"".concat(c,"年").concat(l,"月"),...d,アポ取得率:d.アポ数/d.アプローチ数*100,商談化率:d.商談数/d.アポ数*100,成約率:d.契約数/d.商談数*100,目標達成率:0};n(o);let x=a.map(e=>({date:e.date,アプローチ数:e.approaches,アポ数:e.appointments,商談数:e.meetings,契約数:e.contracts,アポ取得率:e.appointments/e.approaches*100,商談化率:e.meetings/e.appointments*100,成約率:e.contracts/e.meetings*100}));i(x);let m=r.reduce((e,s)=>{let t=s.status,a=e.find(e=>e.ステージ===t);return a?(a.件数++,a.案件リスト.push({会社名:s.companyName,担当者名:s.contactPerson,次回アクション:s.nextAction,次回アクション日:s.nextActionDate,商談金額:s.amount})):e.push({ステージ:t,件数:1,案件リスト:[{会社名:s.companyName,担当者名:s.contactPerson,次回アクション:s.nextAction,次回アクション日:s.nextActionDate,商談金額:s.amount}]}),e},[]);f(m),y([{時間帯:"9-11時",アプローチ成功率:35,アポ取得率:25,商談件数:2},{時間帯:"11-13時",アプローチ成功率:28,アポ取得率:20,商談件数:1},{時間帯:"13-15時",アプローチ成功率:42,アポ取得率:32,商談件数:3},{時間帯:"15-17時",アプローチ成功率:38,アポ取得率:28,商談件数:2},{時間帯:"17-19時",アプローチ成功率:30,アポ取得率:22,商談件数:1}])}catch(e){console.error("Error fetching data:",e)}finally{v(!1)}})()},[e]),N)?(0,a.jsx)("div",{children:"データを読み込み中..."}):t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("select",{value:e,onChange:e=>s(e.target.value),className:"w-full max-w-xs p-2 border rounded-md",children:[(0,a.jsx)("option",{value:"1",children:"鈴木"}),(0,a.jsx)("option",{value:"2",children:"田中"}),(0,a.jsx)("option",{value:"3",children:"佐藤"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"アプローチ数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.アプローチ数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["目標達成率: ",t.目標達成率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"アポイント数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.アポ数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["取得率: ",t.アポ取得率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"商談数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.商談数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["商談化率: ",t.商談化率,"%"]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsx)(u,{className:"text-sm text-gray-500",children:"契約数"})}),(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.契約数}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["成約率: ",t.成約率,"%"]})]})]})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"活動推移"})}),(0,a.jsx)(j,{children:(0,a.jsxs)(d,{defaultValue:"daily",className:"w-full",children:[(0,a.jsxs)(o,{children:[(0,a.jsx)(x,{value:"daily",children:"日次"}),(0,a.jsx)(x,{value:"weekly",children:"週次"}),(0,a.jsx)(x,{value:"monthly",children:"月次"})]}),(0,a.jsx)(m,{value:"daily",children:(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(z.h,{width:"100%",height:"100%",children:(0,a.jsxs)(F.w,{data:l,children:[(0,a.jsx)(Z.q,{strokeDasharray:"3 3"}),(0,a.jsx)(J.K,{dataKey:"date"}),(0,a.jsx)(U.B,{}),(0,a.jsx)(_.u,{}),(0,a.jsx)(L.D,{}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"アプローチ数",stroke:"#8884d8"}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"アポ数",stroke:"#82ca9d"}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"商談数",stroke:"#ffc658"}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"契約数",stroke:"#ff7300"})]})})})})]})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"転換率推移"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"h-[400px]",children:(0,a.jsx)(z.h,{width:"100%",height:"100%",children:(0,a.jsxs)(F.w,{data:l,children:[(0,a.jsx)(Z.q,{strokeDasharray:"3 3"}),(0,a.jsx)(J.K,{dataKey:"date"}),(0,a.jsx)(U.B,{}),(0,a.jsx)(_.u,{}),(0,a.jsx)(L.D,{}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"アポ取得率",stroke:"#8884d8"}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"商談化率",stroke:"#82ca9d"}),(0,a.jsx)(W.x,{type:"monotone",dataKey:"成約率",stroke:"#ffc658"})]})})})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"案件パイプライン"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:c.map((e,s)=>(0,a.jsxs)(h,{className:"bg-gray-50",children:[(0,a.jsx)(p,{className:"pb-2",children:(0,a.jsxs)(u,{className:"text-sm font-medium",children:[e.ステージ,(0,a.jsxs)("span",{className:"ml-2 text-blue-600",children:[e.件数,"件"]})]})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"space-y-2",children:e.案件リスト.map((e,s)=>(0,a.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"font-medium",children:e.会社名}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.担当者名}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["次回: ",e.次回アクション,"（",e.次回アクション日,"）"]}),(0,a.jsxs)("div",{className:"text-sm font-medium text-blue-600",children:["\xa5",e.商談金額.toLocaleString()]})]},s))})})]},s))})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"時間帯別活動効率"})}),(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(z.h,{width:"100%",height:"100%",children:(0,a.jsxs)(B.v,{data:g,children:[(0,a.jsx)(Z.q,{strokeDasharray:"3 3"}),(0,a.jsx)(J.K,{dataKey:"時間帯"}),(0,a.jsx)(U.B,{}),(0,a.jsx)(_.u,{}),(0,a.jsx)(L.D,{}),(0,a.jsx)(Y.$,{dataKey:"アプローチ成功率",fill:"#8884d8"}),(0,a.jsx)(Y.$,{dataKey:"アポ取得率",fill:"#82ca9d"})]})})})})]}),(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"本日のアクション"})}),(0,a.jsx)(j,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[c.flatMap(e=>e.案件リスト.filter(e=>e.次回アクション日===new Date().toISOString().split("T")[0]).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.会社名}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.次回アクション})]}),(0,a.jsx)("div",{className:"text-sm text-blue-600",children:e.次回アクション日})]},s))),c.every(e=>e.案件リスト.every(e=>e.次回アクション日!==new Date().toISOString().split("T")[0]))&&(0,a.jsx)("div",{className:"text-gray-500 text-center py-4",children:"本日のアクション予定はありません"})]})})]})]})]}):(0,a.jsx)("div",{children:"データが見つかりません"})};function H(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(""),[l,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),[o,x]=(0,r.useState)(!1),m=async()=>{try{let e=await fetch("/api/salespersons");if(!e.ok)throw Error("担当者データの取得に失敗しました");let t=await e.json();s(t)}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{i(!1)}};(0,r.useEffect)(()=>{m()},[]);let f=async e=>{if(e.preventDefault(),t.trim()){x(!0);try{if(!(await fetch("/api/salespersons",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.trim()})})).ok)throw Error("担当者の追加に失敗しました");n(""),m()}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{x(!1)}}},g=async e=>{if(confirm("この担当者を削除してもよろしいですか？")){x(!0);try{if(!(await fetch("/api/salespersons",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok)throw Error("担当者の削除に失敗しました");m()}catch(e){d(e instanceof Error?e.message:"予期せぬエラーが発生しました")}finally{x(!1)}}};return l?(0,a.jsx)(h,{children:(0,a.jsx)(j,{className:"flex items-center justify-center p-6",children:(0,a.jsx)(v.Z,{className:"h-6 w-6 animate-spin"})})}):(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(u,{children:"担当者管理"})}),(0,a.jsxs)(j,{children:[c&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-md",children:c}),(0,a.jsx)("form",{onSubmit:f,className:"mb-6",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(C,{type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"担当者名",required:!0}),(0,a.jsx)(S,{type:"submit",disabled:o,children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"追加中..."]}):"追加"})]})}),(0,a.jsx)("div",{className:"space-y-2",children:0===e.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"担当者が登録されていません"}):e.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)(S,{variant:"ghost",size:"sm",onClick:()=>g(e.id),disabled:o,className:"text-red-600 hover:text-red-800",children:"削除"})]},e.id))})]})]})}function G(){return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"営業管理システム"}),(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsxs)(d,{defaultValue:"dashboard",className:"w-full",children:[(0,a.jsxs)(o,{className:"mb-8",children:[(0,a.jsx)(x,{value:"dashboard",children:"全体ダッシュボード"}),(0,a.jsx)(x,{value:"personal",children:"担当者別"}),(0,a.jsx)(x,{value:"daily-input",children:"日次入力"}),(0,a.jsx)(x,{value:"prospects",children:"案件管理"}),(0,a.jsx)(x,{value:"salespersons",children:"担当者管理"})]}),(0,a.jsx)(m,{value:"dashboard",children:(0,a.jsx)(O,{})}),(0,a.jsx)(m,{value:"personal",children:(0,a.jsx)($,{})}),(0,a.jsx)(m,{value:"daily-input",children:(0,a.jsx)(b,{})}),(0,a.jsx)(m,{value:"prospects",children:(0,a.jsx)(V,{})}),(0,a.jsx)(m,{value:"salespersons",children:(0,a.jsx)(H,{})})]})})]})})}}},function(e){e.O(0,[506,971,69,744],function(){return e(e.s=6681)}),_N_E=e.O()}]);